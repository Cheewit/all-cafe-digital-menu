import{R as Be,u as de,r as d,j as e,S as xe,g as te,L as De}from"./index-Di9X6Ag3.js";import{M as _e}from"./MediaDisplay-9q5aOnvH.js";import{t as Re}from"./haptics-C213ZN0-.js";import{O as Ue}from"./OnboardingGuide-BtoUt10b.js";const We=({id:t,productGroup:s,activeCategory:C,activeType:M="all",isAiRecommended:v=!1,priority:F=!1})=>{var ae;const{navigateTo:y,getTranslation:p,selectedLanguage:E,outOfStockItems:I,isFestiveMode:x}=de(),f=I.has(s.id),{displayImageUrl:D,displayedVariantType:m}=d.useMemo(()=>{const c=new Date().getHours();let R=c>=17||c<5?["hot","iced","frappe"]:["iced","frappe","hot"];M&&M!=="all"&&(R=[M,...R.filter(u=>u!==M)]);let N=null;for(const u of R){const b=s.variants.find(z=>z.Type.toLowerCase()===u);if(b){N=b;break}}return!N&&s.variants.length>0&&(N=s.variants[0]),{displayImageUrl:(N==null?void 0:N.Image_URL)||s.image||"",displayedVariantType:(N==null?void 0:N.Type.toLowerCase())||"all"}},[s,M]),$=s.displayName(E),g=d.useMemo(()=>{var T;const c=((T=s.brand)==null?void 0:T.toLowerCase().trim())||"";return c.includes("all select")||c.includes("allselect")},[s.brand]),A=d.useMemo(()=>{if(!s.brand)return null;const c=s.brand.toLowerCase().trim();return c.includes("all cafe")||c.includes("allcafe")?x?"https://i.postimg.cc/ydk08yw2/chritmas-logo.png":"https://i.postimg.cc/qgfsNBYW/all_cafe_logo.png":c.includes("all select")||c.includes("allselect")?"https://i.postimg.cc/jSMh7QYM/Untitled-design.jpg":null},[s.brand,x]),P=d.useMemo(()=>{const c=["ðŸŽ„","âœ¨","ðŸ””","ðŸŽ…","ðŸŽ","ðŸ¦Œ","â­","ðŸ§¸","ðŸŽ»"];return c[Math.floor(Math.random()*c.length)]},[]),_=d.useMemo(()=>Array.from({length:6}).map((c,T)=>{const R=Math.random()*80+10,N=Math.random()*80+10,u=Math.random()*2,b=["bg-white","bg-cyan-300","bg-[#FFD700]"],z=b[Math.floor(Math.random()*b.length)];return e.jsx("div",{className:`glitter-particle ${z}`,style:{top:`${R}%`,left:`${N}%`,animationDelay:`${u}s`,boxShadow:"0 0 2px currentColor"}},T)}),[]),k=()=>{f||(Re(),y(xe.Customization,s,m))},O=c=>{const T=c.toLowerCase();return T==="hot"?"bg-red-600/80 text-white":T==="iced"?"bg-sky-500/80 text-white":T==="frappe"?"bg-purple-500/80 text-white":"bg-gray-500/80 text-white"},{signatureTagToDisplay:L,isNew:H}=d.useMemo(()=>{const c=["7-eleven signature","signature from thailand","signature"],T=s.tags.split(",").map(b=>b.trim()),R=T.map(b=>b.toLowerCase());let N=null;const u=s.tags.toLowerCase().includes("new");for(const b of c){const z=R.indexOf(b);if(z!==-1){N=T[z];break}}return{signatureTagToDisplay:N,isNew:u}},[s.tags]),se=Array.from(new Set(s.variants.map(c=>c.Type).filter(Boolean))),w=s.originalMinPrice&&s.originalMinPrice>s.minPrice;let X;x?X="festive-card-bg":X=g?"bg-gradient-to-b from-[#E0EAFC] to-[#CFDEF3]":"bg-gradient-to-b from-stone-200 to-stone-300";const J=v||L||H||w;return e.jsxs("div",{id:t,className:`glass-panel group overflow-hidden transition-all duration-500 ease-in-out flex flex-col relative ${f?"opacity-50":"hover:-translate-y-1.5 hover:shadow-2xl cursor-pointer"} ${v&&!f?"glow-animation":""} ${x?"festive-border":""}`,onClick:k,"aria-disabled":f,children:[e.jsxs("div",{className:`relative w-full aspect-[3/4] ${X} overflow-hidden`,children:[e.jsx("div",{className:"w-full h-full transition-transform duration-700 ease-out group-hover:scale-105",children:e.jsx(_e,{url:D,altText:$,type:"card",priority:F})}),!f&&H&&e.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",children:_}),f&&e.jsxs("div",{className:"absolute inset-0 bg-black/70 backdrop-blur-sm flex flex-col items-center justify-center text-white text-center p-2 z-30 pointer-events-none",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-10 w-10 mb-2 opacity-80",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M18.364 18.364A9 9 0 005.636 5.636m12.728 12.728A9 9 0 015.636 5.636m12.728 12.728L5.636 5.636"})}),e.jsx("span",{className:"font-bold heading-font text-lg",children:p("outOfStock")})]}),v&&!f&&e.jsxs("div",{className:"absolute top-2 left-2 z-20 bg-emerald-500/80 backdrop-blur-sm text-white font-bold rounded-full shadow-lg px-3 py-1.5 text-xs flex items-center gap-1.5",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z",clipRule:"evenodd"})}),e.jsx("span",{children:p("aiSenseRecommendation")})]}),x&&L&&!w&&!v&&!f&&e.jsx("div",{className:"festive-ribbon",children:"SIGNATURE"}),x&&!f&&H&&!v&&e.jsx("div",{className:"absolute top-2 left-2 z-20 animate-wiggle",children:e.jsxs("div",{className:"bg-gradient-to-r from-[#722F37] to-[#8B0000] text-[#F0EAD6] border border-[#C5A059] px-3 py-1 rounded-full shadow-lg flex items-center gap-1.5",children:[e.jsx("span",{className:"text-xs animate-pulse",children:"âœ¨"}),e.jsx("span",{className:"font-serif-festive text-[10px] font-bold tracking-widest",children:"NEW"}),e.jsx("span",{className:"text-xs animate-pulse delay-75",children:"âœ¨"})]})}),!x&&H&&!f&&!v&&e.jsx("div",{className:"absolute top-2 left-2 z-20 animate-wiggle",children:e.jsxs("div",{className:"bg-gradient-to-r from-amber-400 to-orange-500 text-white font-extrabold text-[10px] sm:text-xs px-3 py-1 rounded-full shadow-lg border border-white/30 backdrop-blur-sm flex items-center gap-1",children:[e.jsx("span",{className:"animate-pulse",children:"âœ¨"}),"NEW ARRIVAL",e.jsx("span",{className:"animate-pulse delay-75",children:"âœ¨"})]})}),w&&!v&&!f&&!H&&e.jsx("div",{className:"absolute z-10 backdrop-blur-sm bg-red-600/80 text-white font-bold rounded-lg shadow-lg top-2 left-2 px-2.5 py-1 text-[10px] sm:text-xs",children:"SPECIAL PRICE"}),!x&&L&&!w&&!v&&!f&&e.jsx("div",{className:"absolute z-10 backdrop-blur-sm bg-black/20 text-white font-bold rounded-lg shadow-lg top-2 right-2 px-2 py-0.5 text-[10px] sm:text-xs",children:p(L.toLowerCase())||L}),x&&!f&&!J&&e.jsx("div",{className:"absolute top-2 right-2 z-20 text-base filter drop-shadow-sm opacity-90 select-none",children:P}),A&&!f&&e.jsx("div",{className:"absolute bottom-1.5 right-1.5 z-20 w-9 h-9 rounded-full shadow-md overflow-hidden bg-white/95 border border-white/40 flex items-center justify-center",children:e.jsx("img",{src:A,alt:s.brand||"Brand",className:"w-full h-full object-cover"})})]}),e.jsxs("div",{className:"p-3 flex flex-col flex-grow",children:[e.jsx("div",{className:"flex justify-between items-start gap-1 mb-1",children:e.jsx("h3",{className:`text-base font-semibold truncate flex-grow ${x?"font-serif-festive tracking-wide text-neutral-800":"heading-font"}`,children:$})}),e.jsx("div",{className:"mb-2",children:e.jsxs("p",{className:"text-sm flex items-baseline gap-1.5 flex-wrap",children:[e.jsx("span",{children:p("fromPrice")}),w?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-lg text-[var(--day-accent)]",children:["à¸¿",s.minPrice.toFixed(2)]}),e.jsxs("span",{className:"line-through text-sm text-[var(--day-text-secondary)]",children:["à¸¿",(ae=s.originalMinPrice)==null?void 0:ae.toFixed(2)]})]}):e.jsxs("span",{className:"font-semibold text-base",children:["à¸¿",s.minPrice.toFixed(2)]})]})}),e.jsx("div",{className:"mt-auto flex justify-between items-end",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:se.map(c=>e.jsx("span",{className:`inline-block py-0.5 px-1.5 rounded-full text-xs font-semibold ${O(c)}`,children:p(c.toLowerCase())||c},c))})})]})]})},Ke=Be.memo(We),Ve=({productGroup:t,activeType:s="all"})=>{var g;const{navigateTo:C,getTranslation:M,selectedLanguage:v,isFestiveMode:F}=de(),{displayImageUrl:y,displayedVariantType:p}=d.useMemo(()=>{const A=new Date().getHours();let _=A>=17||A<5?["hot","iced","frappe"]:["iced","frappe","hot"];s&&s!=="all"&&(_=[s,..._.filter(O=>O!==s)]);let k=null;for(const O of _){const L=t.variants.find(H=>H.Type.toLowerCase()===O);if(L){k=L;break}}return!k&&t.variants.length>0&&(k=t.variants[0]),k?{displayImageUrl:k.Image_URL||t.image||"",displayedVariantType:k.Type.toLowerCase()}:{displayImageUrl:t.image||"",displayedVariantType:"all"}},[t,s]),E=t.displayName(v),I=d.useMemo(()=>{var P;const A=((P=t.brand)==null?void 0:P.toLowerCase().trim())||"";return A.includes("all select")||A.includes("allselect")},[t.brand]),x=d.useMemo(()=>t.tags.toLowerCase().includes("new"),[t.tags]);let f;F?f="festive-card-bg":f=I?"bg-gradient-to-b from-[#E0EAFC] to-[#CFDEF3]":"bg-gradient-to-b from-stone-200 to-stone-300";const D=()=>{C(xe.Customization,t,p)},m=t.originalMinPrice&&t.originalMinPrice>t.minPrice,$=d.useMemo(()=>Array.from({length:8}).map((A,P)=>{const _=Math.random()*80+10,k=Math.random()*80+10,O=Math.random()*2,L=["bg-white","bg-cyan-300","bg-[#FFD700]"],H=L[Math.floor(Math.random()*L.length)];return e.jsx("div",{className:`glitter-particle ${H}`,style:{top:`${_}%`,left:`${k}%`,animationDelay:`${O}s`,boxShadow:"0 0 3px currentColor"}},P)}),[]);return e.jsx("div",{className:"mb-6",onClick:D,children:e.jsxs("div",{className:`glass-panel group overflow-hidden transition-all duration-500 ease-in-out hover:-translate-y-1.5 hover:shadow-2xl cursor-pointer ${F?"festive-border":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:`relative w-full aspect-[1/1] max-w-xs mx-auto ${f} overflow-hidden`,children:[e.jsx("div",{className:"w-full h-full transition-transform duration-700 ease-out group-hover:scale-105",children:e.jsx(_e,{url:y,altText:E,type:"highlight",priority:!0})}),x&&e.jsx("div",{className:"absolute inset-0 z-10 pointer-events-none",children:$})]}),F&&e.jsx("div",{className:"festive-ribbon",children:"SIGNATURE"}),!F&&e.jsx("div",{className:"absolute top-3 left-3 z-20",children:e.jsxs("span",{className:"relative inline-flex items-center py-1.5 px-4 rounded-full text-sm font-semibold bg-yellow-400/80 backdrop-blur-sm text-yellow-900 shadow-md",children:[e.jsx("span",{className:"mr-1.5 animate-pulse-emoji relative z-10",children:"âœ¨"}),e.jsx("span",{className:"relative z-10",children:M("highlightTag")})]})}),m&&e.jsx("div",{className:"absolute top-3 right-3 z-20",children:e.jsx("span",{className:"relative inline-flex items-center py-1.5 px-4 rounded-full text-sm font-semibold bg-red-600/80 backdrop-blur-sm text-white shadow-md",children:"SPECIAL PRICE"})})]}),e.jsxs("div",{className:"p-4 relative",children:[e.jsx("h3",{className:`text-xl font-semibold text-center mb-2 ${F?"font-serif-festive text-neutral-800":"heading-font"}`,children:E}),e.jsxs("div",{className:"text-center",children:[e.jsxs("p",{className:"text-base flex items-baseline justify-center gap-2 flex-wrap",children:[e.jsx("span",{children:M("fromPrice")}),m?e.jsxs(e.Fragment,{children:[e.jsxs("span",{className:"font-bold text-2xl text-[var(--day-accent)]",children:["à¸¿",t.minPrice.toFixed(2)]}),e.jsxs("span",{className:"line-through text-base text-[var(--bdl-text-secondary)]",children:["à¸¿",(g=t.originalMinPrice)==null?void 0:g.toFixed(2)]})]}):e.jsxs("span",{className:"font-semibold text-xl",children:["à¸¿",t.minPrice.toFixed(2)]})]}),e.jsx("p",{className:"text-[10px] text-[var(--bdl-text-secondary)] mt-1 px-2",children:M("priceDisclaimer")})]})]})]})})},Ye=(t=new Date)=>{const s=t.getHours();return s>=0&&s<5?"night":s>=5&&s<11?"morning":s>=11&&s<14?"midday":s>=14&&s<17?"afternoon":s>=17&&s<21?"evening":"late-night"},qe=({onFinished:t})=>{const{isFestiveMode:s}=de();return s?e.jsxs("div",{className:`
        pointer-events-none
        fixed inset-0 z-[999]
        flex items-center justify-center
        bg-gradient-to-br from-[#5b111c] via-[#3b1a23] to-[#0b2a23]
        overflow-hidden
        animate-bowFadeOut
      `,onAnimationEnd:t,children:[e.jsx("div",{className:"absolute inset-x-0 top-1/2 -translate-y-1/2",children:e.jsxs("div",{className:"relative h-12 md:h-16",children:[e.jsx("div",{className:"ribbon-left"}),e.jsx("div",{className:"ribbon-right"})]})}),e.jsxs("div",{className:"relative flex flex-col items-center gap-4 z-10",children:[e.jsx("div",{className:"bow-icon",children:e.jsx("div",{className:"h-24 w-24 md:h-32 md:w-32 rounded-full bg-gradient-to-br from-[#f6d3a0] to-[#C5A059] flex items-center justify-center shadow-[0_10px_30px_rgba(0,0,0,0.4)] border-4 border-[#FFF8E1]",children:e.jsx("span",{className:"text-5xl md:text-6xl drop-shadow-md",children:"ðŸŽ€"})})}),e.jsx("p",{className:"text-xs md:text-sm tracking-[0.3em] uppercase text-[#fbe9c8] font-serif-festive animate-pulse font-bold text-shadow-sm",children:"Unwrapping your menu..."})]})]}):null},ge=12,Qe=8,Xe=t=>{var p,E,I,x,f,D,m,$;if(!t)return!1;const s=te(t.nameKey||"");if(s&&(s.base==="coffee"||(p=s.profile)!=null&&p.includes("caffeinated")))return!0;const C=((I=(E=t.variants)==null?void 0:E.find(g=>g.Name_TH))==null?void 0:I.Name_TH)||((f=(x=t.variants)==null?void 0:x[0])==null?void 0:f.Name_TH)||"";if(C){const g=te(C);if(g&&(g.base==="coffee"||(D=g.profile)!=null&&D.includes("caffeinated")))return!0}const v=((($=(m=t.variants)==null?void 0:m[0])==null?void 0:$.Name_EN)||t.displayName("en")||"").toLowerCase(),F=(t.tags||"").toLowerCase();return!!(t.category==="Coffee"||v.includes("coffee")||v.includes("cappuccino")||v.includes("latte")||v.includes("espresso")||F.includes("coffee"))},Je=["à¸à¸²à¹à¸Ÿà¸£à¹‰à¸­à¸™ Signature","à¹€à¸­à¸ªà¹€à¸žà¸£à¸ªà¹‚à¸‹à¹ˆà¸£à¹‰à¸­à¸™","à¹€à¸­à¸ªà¹€à¸žà¸£à¸ªà¹‚à¸‹à¹ˆà¹€à¸¢à¹‡à¸™"],Pe=t=>Je.some(s=>s===t.trim()),st=()=>{const{getTranslation:t,groupedProducts:s,highlightProductGroup:C,productsLoading:M,productsError:v,fetchProducts:F,omniContext:y,selectedLanguage:p,aiRecommendation:E,setAiRecommendation:I,setAppTheme:x,isFestiveMode:f,currentScreen:D}=de(),[m,$]=d.useState("all"),[g,A]=d.useState("all"),[P,_]=d.useState(ge),k=d.useRef(null),[O,L]=d.useState(!1),[H,se]=d.useState(!1),w=d.useRef(null);d.useEffect(()=>{if(D===xe.Menu&&(f&&(sessionStorage.getItem("hasSeenFestiveIntro")||(L(!0),sessionStorage.setItem("hasSeenFestiveIntro","true"))),!localStorage.getItem("hasSeenMenuGuide_v4"))){w.current&&clearTimeout(w.current);const i=f?9500:8e3;w.current=setTimeout(()=>{se(!0)},i)}return()=>{w.current&&clearTimeout(w.current)}},[f,D]),d.useEffect(()=>{const a=k.current,i=()=>{w.current&&(clearTimeout(w.current),w.current=null)};return a&&a.addEventListener("scroll",i),window.addEventListener("scroll",i),()=>{a&&a.removeEventListener("scroll",i),window.removeEventListener("scroll",i)}},[]);const X=()=>{se(!1),localStorage.setItem("hasSeenMenuGuide_v4","true")},J=()=>{w.current&&(clearTimeout(w.current),w.current=null)},ae=[{elementId:"category-filter-bar",textKey:"onboardingSwipeCategories",gesture:"swipe",position:"bottom"},{elementId:"first-product-card",textKey:"onboardingTapProduct",gesture:"tap",position:"bottom"}];d.useEffect(()=>{x(m==="allselect"?"allselect":"default")},[m,x]);const c=d.useMemo(()=>{const i=[{key:"allcafe",label:t("allCafeClassics"),hasItems:s.some(l=>l.brand==="All cafe")},{key:"allselect",label:"All select",hasItems:s.some(l=>l.brand==="All select")},{key:"promotions",label:t("promotions"),hasItems:s.some(l=>!!l.originalMinPrice)},{key:"recommended",label:t("recommended"),hasItems:s.some(l=>{const h=l.tags.toLowerCase();return h.includes("signature")||h.includes("new")})},{key:"Thai Favorites",label:t("thaiFavorites"),hasItems:s.some(l=>l.tags.toLowerCase().includes("signature from thailand"))},{key:"Coffee",label:t("coffee"),hasItems:s.some(l=>l.category==="Coffee")},{key:"Tea",label:t("tea"),hasItems:s.some(l=>l.category==="Tea")},{key:"Chocolate",label:t("chocolate"),hasItems:s.some(l=>l.category==="Chocolate")},{key:"Milk",label:t("milk"),hasItems:s.some(l=>l.category==="Milk")},{key:"Fruit",label:t("fruit"),hasItems:s.some(l=>l.category==="Fruit")},{key:"Soda",label:t("soda"),hasItems:s.some(l=>l.category==="Soda")}].filter(l=>l.hasItems);return[{key:"all",label:t("allCategories")},...i]},[t,s]),T=d.useMemo(()=>[{key:"all",label:t("allTypes")},{key:"hot",label:t("hot")},{key:"iced",label:t("iced")},{key:"frappe",label:t("frappe")}],[t]);d.useEffect(()=>{c.some(i=>i.key===m)||$("all")},[c,m]);const R=(a,i)=>{J(),$(a);const l=k.current,h=i.currentTarget;if(l&&h){const S=l.offsetWidth,Y=h.offsetLeft,K=h.offsetWidth,Z=Y-S/2+K/2;l.scrollTo({left:Z,behavior:"smooth"})}},N=a=>{J(),A(a),_(ge)},u=d.useMemo(()=>{var i;const a=((i=y==null?void 0:y.timeOfDay)==null?void 0:i.toLowerCase())||"";return a==="morning"?"morning":a==="midday"?"midday":a==="afternoon"?"afternoon":a==="evening"?"evening":a==="night"?"night":a==="late-night"?"late-night":Ye()},[y]),b=d.useMemo(()=>{let a=s;if(m!=="all")switch(m){case"allcafe":a=a.filter(i=>i.brand==="All cafe");break;case"allselect":a=a.filter(i=>i.brand==="All select");break;case"promotions":a=a.filter(i=>!!i.originalMinPrice);break;case"recommended":a=a.filter(i=>{const l=i.tags.toLowerCase();return l.includes("signature")||l.includes("new")}),a.sort((i,l)=>{const h=i.tags.toLowerCase().includes("new"),S=l.tags.toLowerCase().includes("new");return h&&!S?-1:!h&&S?1:0});break;case"Thai Favorites":a=a.filter(i=>i.tags.toLowerCase().includes("signature from thailand"));break;default:a=a.filter(i=>i.category===m);break}if(g!=="all"&&(a=a.filter(i=>i.variants.some(l=>{var h;return((h=l.Type)==null?void 0:h.toLowerCase())===g}))),["all","allcafe","allselect"].includes(m)){const i=a.map(o=>{var Ce,ke,Le,oe,Te,Me,Ie,ce,Se,Fe,Ee,Ae;const j=((Ce=o.variants[0])==null?void 0:Ce.Name_TH)||"",r=te(j);if(!r)return{group:o,score:9999,knowledge:r};let n=50;r.base==="coffee"&&(n-=6),r.base==="tea"&&(n-=4),r.base==="milk"&&(n-=2),r.base==="fruit_juice"&&(n-=3),r.base==="chocolate"&&(n-=1),r.base==="dessert"&&(n+=4),r.base==="soda"&&(n-=2);const B=["th","jp","zh","kr","my","vn","in"],le=["en","fr","ru"],re=B.includes(p),q=le.includes(p),W=((Te=(oe=(Le=(ke=o.variants)==null?void 0:ke[0])==null?void 0:Le.Name_TH)==null?void 0:oe.toLowerCase)==null?void 0:Te.call(oe))??"",G=((Se=(ce=(Ie=(Me=o.variants)==null?void 0:Me[0])==null?void 0:Ie.Name_EN)==null?void 0:ce.toLowerCase)==null?void 0:Se.call(ce))??"",pe=W.includes("à¹€à¸­à¸ªà¹€à¸žà¸£à¸ªà¹‚à¸‹")||G.includes("espresso"),ve=W.includes("à¸­à¹€à¸¡à¸£à¸´à¸à¸²à¹‚à¸™à¹ˆ")||G.includes("americano"),we=W.includes("à¸¥à¸²à¹€à¸•à¹‰")||G.includes("latte"),$e=r.mainFlavor.includes("matcha")||W.includes("à¸¡à¸±à¸—à¸‰à¸°")||G.includes("matcha"),ye=W.includes("à¸Šà¸²à¸™à¸¡à¹€à¸¢à¹‡à¸™")||W.includes("à¸Šà¸²à¹„à¸—à¸¢")||G.includes("thai tea");q&&(u==="morning"?(pe&&(n-=6),ve&&(n-=5),we&&(n-=2),ye&&(n+=4)):we&&(n+=1),r.base==="fruit_juice"&&u!=="morning"&&(n-=1)),re&&(u==="morning"?($e&&(n-=6),ye&&(n-=4),ve&&(n+=3),pe&&(n+=5)):u==="afternoon"&&r.profile.includes("dessert-drink")&&(n-=2),o.tags.toLowerCase().includes("signature from thailand")&&(n-=2)),p==="zh"&&r.mainFlavor.includes("coconut")&&(n-=5);const Ne=(Fe=o.variants)==null?void 0:Fe.some(ee=>{var V;return((V=ee.Type)==null?void 0:V.toLowerCase())==="iced"}),je=(Ee=o.variants)==null?void 0:Ee.some(ee=>{var V;return((V=ee.Type)==null?void 0:V.toLowerCase())==="frappe"}),Q=(Ae=o.variants)==null?void 0:Ae.some(ee=>{var V;return((V=ee.Type)==null?void 0:V.toLowerCase())==="hot"}),ue=r.base==="coffee"||r.profile.includes("caffeinated")||o.category==="Coffee";switch(u){case"morning":ue&&(n-=8),r.base==="tea"&&Q&&(n-=4),o.category==="Pang Yen"&&(n+=8);break;case"midday":r.profile.includes("refreshing")&&(n-=6),Ne&&(n-=3);break;case"afternoon":je&&(n-=4),r.profile.includes("sweet")&&(n-=2);break;case"evening":ue&&(n+=20),(r.profile.includes("comfort")||Q)&&(n-=5);break;case"night":case"late-night":ue&&(n+=40),r.base==="chocolate"&&Q&&(n-=8),r.base==="milk"&&Q&&(n-=6),r.profile.includes("comfort")&&(n-=5);break}y!=null&&y.temp&&(y.temp>=30?(r.profile.includes("refreshing")&&(n-=6),Ne&&(n-=3),je&&(n-=1),Q&&(n+=5)):y.temp<=24&&Q&&(n-=5));const he=o.tags.toLowerCase();return o.originalMinPrice&&(n-=3),he.includes("signature")&&(n-=1),he.includes("block")&&(n+=30),he.includes("push")&&(n-=15),{group:o,score:n,knowledge:r}});i.sort((o,j)=>o.score-j.score);const l=3,h={},S=[],Y=[];for(const o of i){const{group:j,knowledge:r}=o;if(j.tags.toLowerCase().includes("new")){S.push(o);continue}const n=r?r.base:j.category==="Pang Yen"?"dessert_pangyen":j.category;(h[n]||0)<l?(S.push(o),h[n]=(h[n]||0)+1):Y.push(o)}const K=[...S,...Y].map(o=>o.group),Z=["all","allcafe","allselect"].includes(m),fe=u==="late-night"||u==="night",ne=["en","fr","ru"].includes(p);let U=null;if(Z&&g==="all"){const o=K.find(j=>{var le,re,q,W;const r=((le=j.variants[0])==null?void 0:le.Name_TH)||"";if(Pe(r))return!1;const n=te(r);if(!n||fe&&(n.base==="coffee"||(re=n.profile)!=null&&re.includes("caffeinated"))||ne&&u==="morning"&&(r.includes("à¸Šà¸²à¸™à¸¡")||r.includes("à¸Šà¸²à¹„à¸—à¸¢")))return!1;const B=((W=(q=j.tags)==null?void 0:q.toLowerCase)==null?void 0:W.call(q))??"";return!(B.includes("common")||B.includes("basic"))});o&&(U=o.id)}if(U){const o=K.find(j=>j.id===U);if(o){const j=K.filter(B=>B.id!==U),r=j.filter(B=>B.tags.toLowerCase().includes("new")),n=j.filter(B=>!B.tags.toLowerCase().includes("new"));return[o,...r,...n]}}const ie=K.filter(o=>o.tags.toLowerCase().includes("new")),ze=K.filter(o=>!o.tags.toLowerCase().includes("new"));return[...ie,...ze]}return a},[s,m,g,y,p,u]);d.useEffect(()=>{var i;if(["all","allcafe","allselect"].includes(m)&&b.length>0&&g==="all"){const l=b[0],h=((i=l.variants[0])==null?void 0:i.Name_TH)||"",S=te(h),Y=u==="late-night"||u==="night",Z=["en","fr","ru"].includes(p),fe=(()=>{var ne,U,ie;if(Pe(h)||!S||Y&&(S.base==="coffee"||(ne=S.profile)!=null&&ne.includes("caffeinated"))||Z&&u==="morning"&&(h.includes("à¸Šà¸²à¸™à¸¡")||h.includes("à¸Šà¸²à¹„à¸—à¸¢")))return!1;const me=((ie=(U=l.tags)==null?void 0:U.toLowerCase)==null?void 0:ie.call(U))??"";return!(me.includes("common")||me.includes("basic"))})();I(fe?l:null)}else I(null);return()=>{I(null)}},[b,m,g,I,y,u,p]),d.useEffect(()=>{_(ge)},[m,g]);const z=d.useMemo(()=>b.slice(0,P),[b,P]),Oe=()=>{J(),_(a=>a+Qe)};if(M)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full pt-10",children:[e.jsx(De,{}),e.jsx("p",{className:"mt-4 glass-panel px-3 py-1.5 inline-block text-sm",children:t("loadingMenu")})]});if(v)return e.jsxs("div",{className:"flex flex-col items-center justify-center h-full pt-10 text-center max-w-sm mx-auto",children:[e.jsxs("div",{className:"glass-panel p-6",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:t("systemErrorTitle")}),e.jsx("p",{className:"text-sm mb-2",children:t("systemErrorBody1")}),e.jsx("p",{className:"text-sm mb-2",children:t("systemErrorBody2")}),e.jsx("p",{className:"text-sm mb-4",children:t("systemErrorBody3")})]}),e.jsx("button",{onClick:F,className:"mt-6 accent-button py-2.5 px-5",children:t("tryAgain")})]});const He=u==="evening"||u==="night"||u==="late-night",be=!E&&C&&(m==="all"||C.category===m)&&!(He&&Xe(C));return e.jsxs(e.Fragment,{children:[O&&e.jsx(qe,{onFinished:()=>L(!1)}),H&&!O&&e.jsx(Ue,{steps:ae,onComplete:X}),e.jsx("div",{className:`max-w-md mx-auto animate-fadeIn ${O?"opacity-0 scale-95 pointer-events-none":"opacity-100 scale-100 transition-all duration-700"}`,children:e.jsxs("div",{className:"glass-panel",children:[e.jsx("div",{className:"pt-6 px-4",children:e.jsx("h1",{className:`text-[4vw] sm:text-2xl md:text-3xl font-bold text-left whitespace-nowrap ${f?"font-serif-festive tracking-wide text-neutral-800":"heading-font"}`,children:t("menuTitle")})}),e.jsx("div",{id:"category-filter-bar",ref:k,className:"p-4 filter-scroll overflow-x-auto relative z-0",children:e.jsx("div",{className:"flex items-center gap-2 whitespace-nowrap",children:c.map(a=>{const i=m===a.key;let l="bg-[var(--bdl-brand)] text-[var(--bdl-text-inverse)]";return i&&(a.key==="allcafe"?l="bg-[#795548] text-white":a.key==="allselect"&&(l="bg-[#0a2f56] text-white")),e.jsx("button",{onClick:h=>R(a.key,h),className:`px-4 py-2 rounded-[var(--bdl-radius-pill)] text-sm font-semibold transition-all duration-200 shadow-sm
                      ${i?l:"bg-white/80 border border-[var(--bdl-glass-border)] hover:bg-white/90"}`,"aria-pressed":i,children:a.label},a.key)})})}),e.jsx("div",{className:"px-4 pb-2 filter-scroll overflow-x-auto animate-fadeIn",children:e.jsx("div",{className:"flex items-center gap-2 whitespace-nowrap",children:T.map(a=>{const i=g===a.key;return e.jsx("button",{onClick:()=>N(a.key),className:`px-3 py-1.5 rounded-[var(--bdl-radius-pill)] text-xs font-semibold transition-all duration-200 shadow-sm border
                      ${i?"bg-neutral-800 text-white border-neutral-800":"bg-white text-neutral-600 border-[var(--bdl-glass-border)] hover:bg-stone-50"}`,children:a.label},a.key)})})}),e.jsxs("div",{className:"p-4 md:p-6 pb-28",children:[be&&C&&e.jsx(Ve,{productGroup:C,activeCategory:m,activeType:g}),z.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-4",children:z.map((a,i)=>be&&a.id===(C==null?void 0:C.id)?null:e.jsx(Ke,{id:i===0?"first-product-card":void 0,productGroup:a,activeCategory:m,activeType:g,isAiRecommended:!!E&&E.id===a.id,priority:i<8},a.id))}):e.jsx("div",{className:"text-center text-sm py-8 px-4",children:m==="Special Menu"?e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("span",{className:"text-5xl mb-4 animate-pulse-emoji",role:"img","aria-label":"thinking face",children:"ðŸ§ª"}),e.jsx("p",{className:"font-semibold",children:t("noSpecialMenuSuggestion")})]}):e.jsx("p",{children:t("noProductsMatchFiltersSuggestion")})}),b.length>z.length&&e.jsx("div",{className:"mt-8 text-center",children:e.jsx("button",{onClick:Oe,className:"accent-button py-3 px-8",children:t("loadMore")})}),z.length>0&&b.length<=P&&e.jsx("p",{className:"text-center text-sm text-[var(--bdl-text-secondary)] py-8 italic",children:t("noMoreProducts")}),e.jsx("div",{className:"text-center pb-4 opacity-60",children:e.jsxs("p",{className:`text-[10px] ${f?"font-serif-festive italic":""}`,children:["* ",t("advertisingImageDisclaimer")]})})]})]})})]})};export{st as default};
