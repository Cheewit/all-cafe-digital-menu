const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/PostAddToCartModal-8LgR2kFv.js","assets/index-CEpxYsi3.js","assets/haptics-C213ZN0-.js","assets/MediaDisplay-B8Gdx_aW.js","assets/useFocusTrap-CZE16F-E.js"])))=>i.map(i=>d[i]);
import{u as ve,r as a,i as Z,j as t,L as Ne,S as M,_ as Se}from"./index-CEpxYsi3.js";import{M as ke}from"./MediaDisplay-B8Gdx_aW.js";import{a as Ce}from"./haptics-C213ZN0-.js";import{O as Fe}from"./OnboardingGuide-Cp1sI4ty.js";const Ae=a.lazy(()=>Se(()=>import("./PostAddToCartModal-8LgR2kFv.js"),__vite__mapDeps([0,1,2,3,4]))),$e=()=>{var J,K,W,Y,X;const{currentProductGroupForCustomization:o,navigateTo:S,getTranslation:l,getSizeTranslation:V,selectedLanguage:ee,addToCart:te,removeFromCart:se,isFestiveMode:f}=ve(),[p,L]=a.useState(null),[n,k]=a.useState(null),[T,b]=a.useState(""),[x,$]=a.useState([]),[g,C]=a.useState(1),[F,v]=a.useState(!1),[A,I]=a.useState(null),[ne,ae]=a.useState(1),[D,y]=a.useState(!1),[d,j]=a.useState(!1),[Pe,z]=a.useState(!1),[re,P]=a.useState(!1),m=a.useRef(null);a.useEffect(()=>(o&&!d?localStorage.getItem("hasSeenCustomizationGuide_v4")||(m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{P(!0)},5e3)):(E(),P(!1)),()=>{m.current&&clearTimeout(m.current)}),[o,d]);const oe=()=>{P(!1),localStorage.setItem("hasSeenCustomizationGuide_v4","true")},E=()=>{m.current&&(clearTimeout(m.current),m.current=null)},ie=[{elementId:"cust-type-selection",textKey:"onboardingSelectType",gesture:"tap",position:"top"},{elementId:"cust-add-to-cart-btn",textKey:"onboardingAddToCart",gesture:"tap",position:"top"}],N=a.useMemo(()=>o?o.variants.reduce((e,s)=>{const r=s.Type||"Unknown";return e[r]||(e[r]=[]),e[r].push(s),e[r].sort((i,c)=>{const h={S:1,Regular:2,M:3,L:4},u=h[i.Sizes]||parseFloat(i.Price)||99,we=h[c.Sizes]||parseFloat(c.Price)||99;return u-we}),e},{}):{},[o]),U=a.useCallback(()=>{L(null),k(null),b(""),$([]),C(1),z(!1),j(!1),y(!1)},[]);a.useEffect(()=>{o&&U()},[o,U]),a.useEffect(()=>{const e=document.body.style.overflow;return d&&(document.body.style.overflow="hidden"),()=>{document.body.style.overflow=e}},[d]);const le=a.useCallback(e=>{k(e);const s=e.Sweetness,r=s!=null?String(s).split(/[,/|\s]+/).map(i=>i.trim()).filter(Boolean):[];if(r.length>0){const i=r.includes("100")?"100":r.includes("75")?"75":r[0];b(i||"")}else b("")},[]),B=a.useMemo(()=>{const e=n==null?void 0:n.Sweetness;return e!=null?String(e).split(/[,/|\s]+/).map(s=>s.trim()).filter(Boolean):[]},[n]),R=a.useMemo(()=>{if(!(n!=null&&n.Addon_Options))return[];try{const e=JSON.parse(n.Addon_Options);if(Array.isArray(e))return e.filter(s=>typeof s.id=="string"&&typeof s.name=="string"&&typeof s.price=="number")}catch(e){return console.error("Failed to parse Addon_Options JSON. Falling back to legacy string parsing.",e),n.Addon_Options.split(",").map((s,r)=>{const[i,c]=s.split(":");return{id:`legacy-${r}`,name:i.trim(),price:parseInt(c,10)||0}}).filter(s=>s.name&&!isNaN(s.price))}return[]},[n]),ce=e=>{E(),z(!0),L(e),k(null),b(""),j(!0)},de=e=>{$(s=>s.find(r=>r.id===e.id)?s.filter(r=>r.id!==e.id):[...s,e])},q=a.useCallback(()=>{if(!n)return 0;let e=parseFloat(n.Price);const s=n.Promotion_price;if(s&&Z(n)){const i=parseFloat(String(s));isNaN(i)||(e=i)}let r=e;return x.forEach(i=>r+=i.price),r},[n,x]),me=a.useCallback(()=>{if(!n)return 0;let e=parseFloat(n.Price);return x.forEach(s=>e+=s.price),e},[n,x]),ue=async()=>{if(!o||!n||D)return;y(!0),Ce(),j(!1);const e=q(),s=await te(n,o,n.Sizes,T,x,e,g);I(s[0]),ae(g),v(!0)},pe=()=>{v(!1),y(!1),S(M.Confirmation)},xe=()=>{A&&(se(A.id),I(null)),v(!1),y(!1)},he=()=>{v(!1),y(!1),S(M.Menu)},fe=a.useMemo(()=>{var s;const e=((s=o==null?void 0:o.brand)==null?void 0:s.toLowerCase().trim())||"";return e.includes("all select")||e.includes("allselect")},[o])?"bg-gradient-to-b from-[#E0EAFC] to-[#CFDEF3]":"bg-gradient-to-b from-stone-200 to-stone-300",be=a.useMemo(()=>o==null?void 0:o.tags.toLowerCase().includes("new"),[o]),w=f?"font-serif-festive tracking-wide":"heading-font";if(!o)return t.jsx("div",{className:"flex flex-col items-center justify-center h-full pt-10",children:t.jsx(Ne,{})});const G=o.displayName(ee),H=(n==null?void 0:n.Description)||(n==null?void 0:n.Descrpition)||o.description||((J=o.variants.find(e=>e.Description||e.Descrpition))==null?void 0:J.Description)||((K=o.variants.find(e=>e.Description||e.Descrpition))==null?void 0:K.Descrpition),ge=q(),ye=me(),O=ge*g,Q=ye*g,_=e=>e?"bg-neutral-900 text-white font-semibold ring-2 ring-neutral-900/15 shadow-sm":"bg-white/85 text-neutral-800 border border-neutral-300 shadow-sm hover:bg-white/95 focus-visible:ring-2 focus-visible:ring-neutral-400",je=(n==null?void 0:n.Image_URL)||p&&((Y=(W=N[p])==null?void 0:W[0])==null?void 0:Y.Image_URL)||o.image||((X=o.variants.find(e=>e.Image_URL))==null?void 0:X.Image_URL)||"";return t.jsxs(t.Fragment,{children:[re&&!d&&t.jsx(Fe,{steps:ie,onComplete:oe}),t.jsxs("div",{className:`transition-all duration-300 ease-in-out ${F?"blur-md scale-[0.98] pointer-events-none":"blur-none scale-100"}`,children:[t.jsxs("div",{className:"max-w-md mx-auto animate-fadeIn relative",children:[be&&t.jsxs("div",{className:"absolute inset-0 overflow-hidden pointer-events-none z-0 h-screen -mt-24",children:[t.jsx("style",{children:`
                        @keyframes slowFall {
                            0% { transform: translateY(-10%) rotate(0deg); opacity: 0; }
                            10% { opacity: 1; }
                            100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
                        }
                        .confetti-piece {
                            position: absolute;
                            top: -10%;
                            border-radius: 2px;
                            animation-name: slowFall;
                            animation-timing-function: linear;
                            animation-iteration-count: infinite;
                        }
                    `}),Array.from({length:20}).map((e,s)=>{const r=Math.random()*100,i=Math.random()*5,c=8+Math.random()*5,h=["#FFC107","#FF5722","#4CAF50","#2196F3","#E91E63"][Math.floor(Math.random()*5)],u=6+Math.random()*6;return t.jsx("div",{className:"confetti-piece",style:{left:`${r}%`,animationDelay:`${i}s`,animationDuration:`${c}s`,backgroundColor:h,width:`${u}px`,height:`${u}px`,opacity:Math.random()*.6+.4}},s)})]}),t.jsx("div",{className:"flex justify-start items-center mb-4 relative z-10",children:t.jsxs("button",{onClick:()=>S(M.Menu),className:"flex items-center font-semibold py-2.5 px-4 rounded-full bg-black/25 backdrop-blur-md border border-white/15 shadow-sm hover:bg-black/40 hover:shadow-md transition-all duration-200 text-white group",children:[t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 mr-1 group-hover:-translate-x-1 transition-transform text-white/90",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2.5,children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 19l-7-7 7-7"})}),l("backButton")]})}),t.jsxs("div",{className:"mb-6 relative z-10",children:[t.jsxs("div",{className:`relative w-full aspect-[3/4] max-w-64 mx-auto mb-4 rounded-2xl ${fe} overflow-hidden shadow-lg group`,children:[t.jsx(ke,{url:je,altText:G,type:"customization",priority:!0}),t.jsx("div",{className:"absolute bottom-2 right-3 pointer-events-none opacity-70 group-hover:opacity-100 transition-opacity duration-300",children:t.jsxs("span",{className:`text-[8px] text-black/50 font-medium px-1.5 py-0.5 rounded-md bg-white/40 backdrop-blur-[2px] ${f?"font-serif-festive italic":""}`,children:["* ",l("advertisingImageDisclaimer")]})})]}),t.jsx("h3",{className:`text-3xl font-bold text-center mb-2 drop-shadow-sm ${w}`,children:t.jsx("span",{className:"bg-white/90 text-neutral-900 px-5 py-2 rounded-xl shadow-sm backdrop-blur-sm inline-block",children:G})}),H&&t.jsx("div",{className:"text-center px-6 animate-fadeIn mt-3 max-w-sm mx-auto",children:t.jsx("div",{className:"bg-white/60 backdrop-blur-md p-4 rounded-xl border border-white/40 shadow-sm",children:t.jsx("p",{className:"text-sm text-neutral-700 font-medium leading-relaxed whitespace-pre-line",children:H})})})]}),t.jsx("div",{className:`space-y-6 px-2 relative z-10 ${f?"pb-32":"pb-6"}`,children:t.jsxs("div",{className:"glass-panel p-4",children:[t.jsx("p",{className:"text-center text-sm text-[var(--bdl-text-secondary)] mb-4",children:l("selectDrinkTypePrompt")}),t.jsx("label",{className:`block font-semibold mb-3 ${w}`,children:l("typeLabel")}),t.jsx("div",{id:"cust-type-selection",className:"grid grid-cols-3 gap-3",children:Object.keys(N).map(e=>{const s=p===e;return t.jsx("button",{onClick:()=>ce(e),className:`py-3 px-2 rounded-xl text-sm font-semibold transition-all duration-300 ease-in-out text-center focus:outline-none flex items-center justify-center gap-2 relative ${_(s)}`,"aria-pressed":s,children:l(e.toLowerCase())||e},e)})})]})})]}),t.jsxs("div",{className:`fixed inset-0 z-[210] ${d?"pointer-events-auto":"pointer-events-none"}`,"aria-hidden":!d,children:[t.jsx("div",{onClick:()=>j(!1),className:`absolute inset-0 bg-black/60 transition-opacity duration-300
                        ${d?"opacity-100":"opacity-0"}`}),t.jsxs("div",{role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),className:`absolute bottom-0 left-0 w-full max-w-[600px] mx-auto right-0
                        bg-white/90 backdrop-blur-md
                        border-t border-white/30 shadow-[0_-8px_40px_-5px_rgba(0,0,0,.35)]
                        transition-transform duration-300 ease-out
                        ${d?"translate-y-0":"translate-y-full"}
                        rounded-t-2xl flex flex-col max-h-[90dvh]`,children:[t.jsx("div",{className:"flex justify-center py-2 cursor-grab flex-shrink-0",onClick:()=>j(!1),children:t.jsx("div",{className:"h-1.5 w-12 bg-neutral-400/40 rounded-full"})}),t.jsxs("div",{className:"px-4 pb-4 space-y-6 overflow-y-auto flex-1 min-h-0",children:[p&&N[p]&&t.jsxs("div",{children:[t.jsx("label",{className:`block font-semibold mb-2 ${w}`,children:l("sizeLabel")}),t.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:N[p].map(e=>{const s=(n==null?void 0:n.Product_Code)===e.Product_Code,r=parseFloat(e.Price),i=e.Promotion_price;let c=null;if(i){const u=parseFloat(String(i));isNaN(u)||(c=u)}const h=c!==null&&Z(e);return t.jsx("button",{onClick:()=>le(e),className:`py-2 px-1 rounded-xl text-sm transition-all duration-300 text-center focus:outline-none relative ${_(s)}`,"aria-pressed":s,children:t.jsxs("div",{className:"flex flex-col items-center justify-center leading-tight",children:[t.jsx("span",{children:V(e.Sizes)}),h&&c!==null?t.jsxs("div",{className:"flex items-baseline gap-1.5 mt-1",children:[t.jsxs("span",{className:"font-bold text-base",children:["฿",c.toFixed(2)]}),t.jsxs("span",{className:"text-xs line-through opacity-70",children:["฿",r.toFixed(2)]})]}):t.jsxs("span",{className:"font-semibold mt-1",children:["฿",e.Price]})]})},e.Product_Code||e.Name_EN)})})]}),n&&B.length>0&&t.jsxs("div",{className:"animate-slideUpFadeIn",children:[t.jsx("label",{className:`block font-semibold mb-2 ${w}`,children:l("sweetnessLabel")}),t.jsx("div",{className:"grid grid-cols-3 gap-2",children:B.map(e=>{const s=T===e;return t.jsxs("button",{onClick:()=>b(e),className:`flex-1 py-3 px-3 rounded-lg text-sm transition-all duration-300 text-center focus:outline-none relative ${_(s)}`,"aria-pressed":s,children:[e,"%"]},e)})})]}),n&&R.length>0&&t.jsxs("div",{className:"animate-slideUpFadeIn",style:{animationDelay:"75ms"},children:[t.jsx("label",{className:`block font-semibold mb-2 ${w}`,children:l("addonLabel")}),t.jsx("div",{className:"space-y-2",children:R.map(e=>{const s=x.some(r=>r.id===e.id);return t.jsxs("label",{className:`flex items-center p-3 rounded-xl cursor-pointer transition-all duration-200
                                    ${s?"bg-white/90 text-neutral-900 border border-neutral-300 ring-2 ring-neutral-400/30":"bg-white/70 text-neutral-800 border border-neutral-300 hover:bg-white/85"}`,children:[t.jsxs("span",{className:"flex-1",children:[e.name," (+฿",e.price,")"]}),t.jsx("div",{className:`w-5 h-5 rounded-full flex items-center justify-center transition-all duration-200 ${s?"bg-[var(--day-accent)]":"bg-gray-300"}`,children:s&&t.jsx("svg",{className:"w-3 h-3 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:t.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),t.jsx("input",{type:"checkbox",checked:s,onChange:()=>de(e),className:"sr-only"})]},e.id)})})]})]}),t.jsxs("div",{className:`px-4 pt-3 border-t border-white/20 flex-shrink-0 pb-[calc(env(safe-area-inset-bottom,30px)+${f?"2.5rem":"1.5rem"})]`,children:[n&&t.jsxs("div",{className:"flex items-center justify-center gap-5 mb-4",children:[t.jsx("button",{onClick:()=>C(e=>Math.max(1,e-1)),className:"w-10 h-10 rounded-full bg-white border border-gray-200 text-xl font-bold shadow-sm hover:bg-gray-50 transition-colors active:scale-95 flex items-center justify-center text-neutral-700","aria-label":"Decrease quantity",children:"-"}),t.jsxs("div",{className:"flex flex-col items-center justify-center",children:[t.jsx("span",{className:"text-xs text-gray-500 font-medium",children:l("quantityLabel")}),t.jsx("span",{className:"text-xl font-bold min-w-[2rem] text-center heading-font",children:g})]}),t.jsx("button",{onClick:()=>C(e=>Math.min(20,e+1)),className:"w-10 h-10 rounded-full bg-white border border-gray-200 text-xl font-bold shadow-sm hover:bg-gray-50 transition-colors active:scale-95 flex items-center justify-center text-neutral-700","aria-label":"Increase quantity",children:"+"})]}),t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("div",{className:"flex items-baseline min-h-[40px]","aria-live":"polite","aria-atomic":"true",children:n&&t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"text-sm font-semibold",children:[l("totalLabel"),":"]}),Q>O?t.jsxs(t.Fragment,{children:[t.jsxs("span",{className:"ml-2 font-extrabold text-[var(--day-accent)] text-3xl",children:["฿",O.toFixed(2)]}),t.jsxs("span",{className:"ml-2 text-lg line-through text-[var(--bdl-text-secondary)]",children:["฿",Q.toFixed(2)]})]}):t.jsxs("span",{className:"ml-2 text-2xl font-bold",children:["฿",O.toFixed(2)]})]})}),t.jsx("button",{id:"cust-add-to-cart-btn",onClick:ue,disabled:!n||D,className:`py-3 px-6 rounded-full font-bold shadow-lg transition-all transform active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed
                         ${f?"bg-gradient-to-r from-[#8B0000] to-[#58181F] text-[#F0EAD6] border border-[#C5A059] shadow-red-900/30":"bg-gradient-to-r from-emerald-500 to-emerald-700 text-white shadow-emerald-900/20 border border-emerald-400/20"}
                      `,children:l("addToCartButton")})]}),t.jsx("p",{className:"text-[10px] text-[var(--bdl-text-secondary)] text-center mt-1.5",children:l("priceDisclaimer")})]})]})]})]}),t.jsx(a.Suspense,{fallback:null,children:F&&t.jsx(Ae,{isOpen:F,onConfirm:pe,onClose:xe,onAddAnother:he,item:A,quantity:ne})})]})};export{$e as default};
